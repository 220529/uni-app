# 开发规范

> CPM 微信小程序 v2 开发规范和最佳实践

## 🎨 代码风格规范

- **120字符行宽**，单引号，必须分号
- **ESLint + Prettier** 自动修复
- **uni** 等全局变量已配置白名单

```bash
pnpm run format    # 格式化
pnpm run lint      # 检查修复
```

## 📝 Git 提交规范

### 提交类型
| 类型 | 描述 | 示例 |
|------|------|------|
| ✨ feat | 新功能 | `feat: 添加用户登录功能` |
| 🐛 fix | 修复bug | `fix: 修复登录页面闪烁问题` |
| 📝 docs | 文档变更 | `docs: 更新API文档` |
| 💄 style | 代码格式 | `style: 修复代码缩进` |
| ♻️ refactor | 重构 | `refactor: 优化请求拦截器逻辑` |
| ⚡ perf | 性能优化 | `perf: 优化页面渲染性能` |
| ✅ test | 测试相关 | `test: 添加登录功能测试` |
| 🔧 chore | 工具变动 | `chore: 更新依赖版本` |

```bash
# 推荐使用工具提交
pnpm run commit
```

## 🔄 开发流程

```bash
git add .
pnpm run commit    # 自动格式化 + 规范提交
```

**Git Hooks**: pre-commit 自动修复格式，commit-msg 验证提交信息

## 🧩 组件开发规范

- **命名**: 文件夹 PascalCase，组件前缀 `cpm-`
- **结构**: 统一使用 `components/cpm-xxx/index.vue`

```vue
<template>
  <view class="cpm-example">
    <!-- 内容 -->
  </view>
</template>

<script setup>
// 逻辑
</script>

<style lang="scss" scoped>
.cpm-example { /* 样式 */ }
</style>
```

## 🔌 API 开发规范

```javascript
// api/example.js
export default {
  getList: (params) => request.get('/api/list', { params }),
  getDetail: (id) => request.get(`/api/detail/${id}`),
  create: (data) => request.post('/api/create', data),
};

// 页面使用
import { userApi } from '@/api';
const result = await userApi.getUserInfo();
```

## 📁 目录结构规范

```
src/
├── api/          # 接口层
├── auth/         # 认证模块
├── components/   # 组件
├── pages/        # 页面
├── utils/        # 工具
└── store/        # 状态管理
```

## 🌍 环境变量规范

**配置文件**: `.env`, `.env.local`, `.env.development`, `.env.production`

```bash
# 统一使用 VITE_ 前缀
VITE_API_BASE_URL=https://api.example.com
VITE_TENANT_ID=1
VITE_ENABLE_DEBUG=true
```

```javascript
// utils/env.js 使用
export const API_BASE_URL = import.meta.env.VITE_API_BASE_URL;
```

## ❓ 常见问题

- **格式错误**: 运行 `pnpm run lint` 自动修复
- **提交被拦截**: 使用 `pnpm run commit` 而不是 `git commit`  
- **环境变量失效**: 检查 `VITE_` 前缀和文件命名
- **Git Hooks 失效**: 确保执行过 `pnpm install`

## 🎯 最佳实践

- 安装编辑器 Prettier 插件
- 组件统一 `cpm-` 前缀
- 使用 API 模块而不是直接请求
- 新成员必须先运行 `pnpm install`
